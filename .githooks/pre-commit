#!/bin/sh

files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json|css|md)$')
[ -z "$files" ] && exit 0

bad=0

for f in $files; do
  if git show ":$f" | LC_ALL=C grep -q "$(printf '\000')"; then
    echo "âœ— $f looks like UTF-16/binary (contains NUL). Please convert to UTF-8 (no BOM)."
    bad=1
  fi
done

if [ $bad -eq 1 ]; then
  echo "Commit blocked due to invalid encoding."
  exit 1
fi

exit 0